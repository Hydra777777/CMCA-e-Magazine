<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMCA 40th Anniversary Magazine</title>
    <!-- Favicon -->
    <link rel="icon" href="Images\favicon.png" type="image/png">
    <!-- Tailwind CSS CDN for basic styling -->
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent body scroll */
        }

        body {
            font-family: "Inter", sans-serif;
            display: flex;
            flex-direction: column; /* Stack magazine and controls vertically */
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
            background-color: #1a202c;
            color: #e2e8f0;
            background-image: url('Images/flipbook bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            width: 100vw;
            height: 100vh;
        }

        #magazine {
            background-color: #2d3748;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0; /* Prevent shrinking if space is tight */
        }

        #magazine .page {
            background-color: #2d3748;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        #magazine .page img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 4px;
        }

        /* Navigation Controls Styling */
        #navigation-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            background-color: rgba(45, 55, 72, 0.8);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 10;
            margin-top: 20px; /* Space between magazine and controls */
        }

        .nav-button {
            background-color: #4a5568;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            font-weight: bold;
            border: none;
            outline: none;
        }

        .page-input {
            width: 60px;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #4a5568;
            background-color: #2d3748;
            color: #e2e8f0;
            text-align: center;
        }

        .page-indicator {
            color: #e2e8f0;
            font-size: 1rem;
            min-width: 80px;
            text-align: center;
        }

        /* Table of Contents Modal Styling */
        #toc-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
        }

        #toc-modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        #toc-modal-content {
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 8px; /* Ensure border-radius is applied */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
            max-width: 1000px; /* Increased max-width for wider modal */
            width: 90vw; /* Also use vw to ensure it scales down on smaller screens */
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #toc-modal-content h2 {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e2e8f0;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        #toc-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #e2e8f0;
            cursor: pointer;
            transition: color 0.2s ease-in-out;
        }

        #toc-close-btn:hover {
            color: #ef4444; /* Red for close button hover */
        }

        #thumbnails-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Adjusted minmax for larger thumbnails/more columns */
            gap: 1rem;
            padding: 1rem;
            justify-items: center;
            align-items: start;
        }

        .thumbnail-item {
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .thumbnail-item:hover {
            border-color: #6366f1;
            transform: translateY(-3px);
        }

        .thumbnail-item img {
            width: 100px; /* Adjusted thumbnail width */
            height: 125px; /* Adjusted thumbnail height (maintaining 400x500 aspect ratio) */
            object-fit: cover; /* Cover to fill the thumbnail box */
            border-radius: 2px;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .thumbnail-item span {
            font-size: 0.9rem;
            color: #cbd5e0;
        }

        @media (max-width: 600px) {
            #navigation-controls {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem 1rem;
            }
            #toc-modal-content {
                padding: 1rem;
                max-width: 95vw; /* Ensure it scales down on very small screens */
            }
            #toc-modal-content h2 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            #thumbnails-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 0.75rem;
            }
            .thumbnail-item img {
                width: 60px;
                height: 75px;
            }
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center">

    <div id="magazine" class="relative rounded-lg shadow-xl">
        <!--
            IMPORTANT: The order of these <div class="page"> elements directly determines
            the page order in your e-magazine and the Table of Contents.
            Please ensure they are in the correct sequential order for your content.

            - The first <div class="page"> should be your Cover Page.
            - Subsequent <div class="page"> elements should follow the internal page order.
            - The last <div class="page"> should be your Back Cover.

            Replace the 'src' attribute of the <img> tags with your actual image paths.
            Example: <img src="path/to/your/image.jpg" alt="Description of your page">
        -->
        <div class="page">
            <img src="pages/1.png" alt="Cover Page">
        </div>
        <div class="page">
            <img src="pages/2.png" alt="Page 2 Content">
        </div>
        <div class="page">
            <img src="PAGES/3.png" alt="Page 3 Content">
        </div>
        <div class="page">
            <img src="PAGES/4.png" alt="Page 4 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+5" alt="Page 5 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+6" alt="Page 6 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+7" alt="Page 7 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+8" alt="Page 8 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+9" alt="Page 9 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+10" alt="Page 10 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+11" alt="Page 11 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+12" alt="Page 12 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+13" alt="Page 13 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+14" alt="Page 14 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+15" alt="Page 15 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+16" alt="Page 16 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+17" alt="Page 17 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+18" alt="Page 18 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+19" alt="Page 19 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+20" alt="Page 20 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+21" alt="Page 21 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+22" alt="Page 22 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+23" alt="Page 23 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/4B5563/F9FAFB?text=Page+24" alt="Page 24 Content">
        </div>
        <div class="page">
            <img src="https://placehold.co/400x500/374151/D1D5DB?text=Page+25" alt="Page 25 Content">
        </div>
        <div class="page">
            <img src="PAGES/5.png" alt="Back Cover">
        </div>
    </div>

    <div id="navigation-controls">
        <button id="prev-btn" class="nav-button">Previous</button>
        <span id="page-indicator" class="page-indicator">Page 1 of 26</span>
        <input type="number" id="page-jump-input" class="page-input" min="1" value="1">
        <button id="go-btn" class="nav-button">Go</button>
        <button id="next-btn" class="nav-button">Next</button>
        <button id="toc-btn" class="nav-button">Table of Contents</button>
    </div>

    <!-- Table of Contents Modal -->
    <div id="toc-modal-overlay">
        <div id="toc-modal-content">
            <button id="toc-close-btn">&times;</button>
            <h2>Table of Contents</h2>
            <div id="thumbnails-container">
                <!-- Thumbnails will be dynamically inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="lib/turn.min.js"></script>

    <script>
        $(document).ready(function() {
            var magazine = $('#magazine');
            var totalPages = magazine.find('.page').length;
            var pageIndicator = $('#page-indicator');
            var pageJumpInput = $('#page-jump-input');
            var images = magazine.find('img');
            var totalImages = images.length;
            var loadedImages = 0;

            // Table of Contents elements
            var tocBtn = $('#toc-btn');
            var tocModalOverlay = $('#toc-modal-overlay');
            var tocCloseBtn = $('#toc-close-btn');
            var thumbnailsContainer = $('#thumbnails-container');

            // Function to update the page indicator
            function updatePageIndicator(currentPage) {
                pageIndicator.text('Page ' + currentPage + ' of ' + totalPages);
                pageJumpInput.val(currentPage);
            }

            // Function to initialize or resize the magazine
            function initializeMagazine() {
                var windowWidth = $(window).width();
                var windowHeight = $(window).height();

                // Define the aspect ratio of the entire magazine (double page spread)
                const magazineAspectRatio = 800 / 500;

                // Get the height of navigation controls
                const navControlsHeight = $('#navigation-controls').outerHeight(true) || 0;

                // Define some padding around the magazine and controls
                const verticalPadding = 40;
                const horizontalPadding = 40;

                // Calculate available space for the magazine
                const availableHeight = windowHeight - navControlsHeight - verticalPadding;
                const availableWidth = windowWidth - horizontalPadding;

                let targetMagazineWidth = availableWidth;
                let targetMagazineHeight = availableWidth / magazineAspectRatio;

                // If scaling by width makes it too tall, scale by height instead
                if (targetMagazineHeight > availableHeight) {
                    targetMagazineHeight = availableHeight;
                    targetMagazineWidth = availableHeight * magazineAspectRatio;
                }

                // Apply calculated dimensions to the magazine container
                magazine.css({
                    width: targetMagazineWidth + 'px',
                    height: targetMagazineHeight + 'px'
                });

                if ($.fn.turn) {
                    if (magazine.data('turn-page') === undefined) {
                        magazine.turn({
                            width: targetMagazineWidth,
                            height: targetMagazineHeight,
                            autoCenter: true,
                            gradients: true,
                            acceleration: false,
                            display: 'double',
                            duration: 1000,
                        });
                        updatePageIndicator(magazine.turn('page'));
                    } else {
                        magazine.turn('size', targetMagazineWidth, targetMagazineHeight);
                    }
                } else {
                    console.error("Error: turn.js function not found. Ensure the script is loaded correctly.");
                }
            }

            // Function to generate and display thumbnails
            function generateThumbnails() {
                thumbnailsContainer.empty(); // Clear existing thumbnails
                console.log("Generating thumbnails for " + totalPages + " pages.");
                for (let i = 1; i <= totalPages; i++) {
                    const pageElement = magazine.find('.page').eq(i - 1);
                    const originalImgElement = pageElement.find('img');
                    const originalImgSrc = originalImgElement.attr('src');
                    let thumbnailUrl;
                    let pageLabel;

                    // Determine the page label (Cover Page, Page X, Back Cover)
                    if (i === 1) {
                        pageLabel = "Cover Page";
                    } else if (i === totalPages) {
                        pageLabel = "Back Cover";
                    } else {
                        pageLabel = `Page ${i}`;
                    }

                    // Use the original image source if it's provided and not empty.
                    // The browser will handle loading errors for actual image URLs.
                    if (originalImgSrc && originalImgSrc.trim() !== '') {
                        thumbnailUrl = originalImgSrc;
                        console.log(`Page ${i}: Using actual image source: ${thumbnailUrl}`);
                    } else {
                        // If originalImgSrc is empty or invalid, generate a specific placeholder.
                        const bgColor = (i === 1) ? '374151' : (i === totalPages ? '2D3748' : '4B5563');
                        const textColor = (i === 1) ? 'D1D5DB' : (i === totalPages ? 'E2E8F0' : 'F9FAFB');
                        const placeholderText = pageLabel.replace(/ /g, '+'); // Replace spaces for URL
                        thumbnailUrl = `https://placehold.co/100x125/${bgColor}/${textColor}?text=${placeholderText}`;
                        console.log(`Page ${i}: Original image source was empty/invalid. Using generated placeholder: ${thumbnailUrl}`);
                    }

                    const thumbnailItem = $('<div class="thumbnail-item"></div>');
                    const thumbnailImg = $('<img>').attr('src', thumbnailUrl).attr('alt', pageLabel);
                    const pageNumberSpan = $('<span>').text(pageLabel);

                    thumbnailItem.append(thumbnailImg).append(pageNumberSpan);
                    thumbnailItem.data('page', i); // Store page number in data attribute

                    thumbnailsContainer.append(thumbnailItem);
                }
                console.log("Thumbnails generated.");
            }

            // Event listeners for Table of Contents
            tocBtn.on('click', function() {
                console.log("Table of Contents button clicked.");
                generateThumbnails(); // Regenerate thumbnails to ensure they are up-to-date
                tocModalOverlay.addClass('visible');
                console.log("TOC modal visibility class added.");
            });

            tocCloseBtn.on('click', function() {
                tocModalOverlay.removeClass('visible');
            });

            // Close modal when clicking outside content
            tocModalOverlay.on('click', function(e) {
                if ($(e.target).is(tocModalOverlay)) {
                    tocModalOverlay.removeClass('visible');
                }
            });

            // Click handler for thumbnails
            thumbnailsContainer.on('click', '.thumbnail-item', function() {
                const pageNum = $(this).data('page');
                if (pageNum) {
                    magazine.turn('page', pageNum);
                    tocModalOverlay.removeClass('visible'); // Close modal after navigating
                }
            });

            // Load all images first, then initialize turn.js
            if (totalImages === 0) {
                initializeMagazine();
            } else {
                images.each(function() {
                    if (this.complete) {
                        loadedImages++;
                    } else {
                        $(this).on('load', function() {
                            loadedImages++;
                            if (loadedImages === totalPages) {
                                initializeMagazine();
                            }
                        }).on('error', function() {
                            console.error("Error loading image:", this.src);
                            loadedImages++;
                            if (loadedImages === totalPages) {
                                initializeMagazine();
                            }
                        });
                    }
                });
                if (loadedImages === totalImages) {
                    initializeMagazine();
                }
            }

            // Add keyboard navigation
            $(document).keydown(function(e){
                if (e.keyCode == 37) { // Left arrow key
                    magazine.turn('previous');
                    e.preventDefault();
                } else if (e.keyCode == 39) { // Right arrow key
                    magazine.turn('next');
                    e.preventDefault();
                }
            });

            // Debounce function for resize event
            var resizeTimer;
            $(window).on('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    initializeMagazine();
                }, 250);
            });

            // Navigation button click handlers
            $('#prev-btn').on('click', function() {
                magazine.turn('previous');
            });

            $('#next-btn').on('click', function() {
                magazine.turn('next');
            });

            $('#go-btn').on('click', function() {
                var pageNum = parseInt(pageJumpInput.val(), 10);
                if (!isNaN(pageNum) && pageNum >= 1 && pageNum <= totalPages) {
                    magazine.turn('page', pageNum);
                } else {
                    console.warn("Invalid page number. Please enter a number between 1 and " + totalPages);
                }
            });

            // Listen for the 'turned' event to update the page indicator
            magazine.on('turned', function(event, page, view) {
                updatePageIndicator(page);
            });
        });
    </script>
</body>
</html>
